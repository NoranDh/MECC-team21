<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Proxy - Agent</title>  
        <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">

        <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family:"KoHo", sans-serif ;
        }
        body {
            background-repeat: no-repeat;
            background-size: cover;
            justify-content: center;
            align-items: center;
            min-height:100vh ;
            margin:0;
            background: url("whitbg.jpeg") center/cover no-repeat;
            padding-top: 100px;
            font-family: "KoHo", sans-serif;
        }

        .header{
            width:100%;
            top:0;
            position: fixed;
        }
        nav{
            display:flex;
            padding:2% 6%;
            justify-content: space-between;
            align-items: center;
        }

        nav img{
            width:150px;
        }

        .nav-links{
            flex:1;
            text-align: right;
        }

        .nav-links ul li{
            list-style:none;
            display:inline-block;
            padding: 8px 12px;
            position: relative;
        }

        .nav-links ul li a{
            color:#404143;
            text-decoration: none;
            font-size: 13px;
        }
        .nav-links ul li::after{
            content:'' ;
            width:0%;
            height: 2px;
            background: #404143;
            display: block;
            margin:auto;
            transition:0.5s;
        }
        .nav-links ul li:hover::after{
            width:100%;
        }

        /* ---------- Agent section styles ---------- */

        .agent-wrapper{
            max-width: 950px;
            margin: 0 auto;
            margin-top: 40px;
            padding: 24px 28px;
            background: rgba(255,255,255,0.85);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }

        .agent-title{
            font-size: 26px;
            font-weight: 600;
            color:#333;
            margin-bottom: 8px;
        }

        .agent-subtitle{
            font-size: 14px;
            color:#555;
            margin-bottom: 16px;
        }

        .agent-form{
            display:flex;
            flex-direction:column;
            gap: 12px;
        }

        .agent-form label{
            font-size: 13px;
            color:#333;
            font-weight: 500;
        }

        .agent-form select,
        .agent-form textarea{
            width:100%;
            margin-top: 4px;
            padding: 8px 10px;
            border-radius: 8px;
            border:1px solid #ccc;
            font-size: 13px;
            resize: vertical;
            background: #fff;
        }

        .agent-form button{
            align-self:flex-start;
            margin-top: 4px;
            padding: 8px 18px;
            border-radius: 999px;
            border:none;
            cursor:pointer;
            font-size: 13px;
            font-weight: 600;
            background:#404143;
            color:#fff;
            transition: background 0.2s, transform 0.1s;
        }
        .agent-form button:hover{
            background:#2e2f31;
            transform: translateY(-1px);
        }

        .agent-status{
            display:none;
            margin-top: 14px;
            font-size: 13px;
            color:#333;
            display:flex;
            align-items:center;
            gap:8px;
        }

        .agent-spinner{
            width:16px;
            height:16px;
            border-radius:50%;
            border:2px solid #b3b3b3;
            border-top-color:#404143;
            animation: spin 0.8s linear infinite;
        }

        .agent-results{
            display:none;
            margin-top: 22px;
        }

        .agent-section-title{
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            color:#333;
        }

        .agent-mechanisms{
            font-size: 13px;
            white-space: pre-wrap;
            background:#f7f7f7;
            border-radius: 10px;
            padding:10px 12px;
            margin-bottom: 16px;
        }

        .agent-recs h4{
            font-size: 14px;
            margin: 10px 0 4px;
            color:#333;
        }

        .agent-recs ul{
            margin-left:18px;
            font-size:13px;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px){
            .agent-wrapper{
                margin: 20px;
                padding:18px;
            }
        }
        </style>
    </head>   
    <body>
        <section class="header">
            <nav>
                <a href="indexx.html"><img src="Logo.jpeg" alt="Proxy logo"></a>
                <div class="nav-links" id="navLinks">
                    <ul>
                        <li><a href="Index.html">Home</a></li>
                        <li><a href="CV.html">Digital Lab</a></li>
                        <li><a href="Agent.html">Agent</a></li>
                    </ul>
                </div>
            </nav>
        </section>

        <!-- Agent content -->
        <section class="page page2">
            <div class="agent-wrapper">
                <h1 class="agent-title">Failure Analysis Agent</h1>
                <p class="agent-subtitle">
                    Describe the failure scenario. The agent will use API&nbsp;571,
                    handbook data, and case studies to reason and suggest recommendations.
                </p>

                <form id="agent-form" class="agent-form">
                    <label>
                        Mechanism (initial guess)
                        <select id="mechanism">
                            <option value="3.1">885 °F (475 °C) Embrittlement (3.1)</option>
                            <option value="3.2">Amine Corrosion (3.2)</option>
                            <option value="3.3">Amine Stress Corrosion Cracking (3.3)</option>
                            <option value="3.4">Ammonia Stress Corrosion Cracking (3.4)</option>
                            <option value="3.5">Ammonium Bisulfide Corrosion (Alkaline Sour Water) (3.5)</option>
                            <option value="3.6">Ammonium Chloride and Amine Hydrochloride Corrosion (3.6)</option>
                            <option value="3.7">Aqueous Organic Acid Corrosion (3.7)</option>
                            <option value="3.8">Atmospheric Corrosion (3.8)</option>
                            <option value="3.9">Boiler Water and Steam Condensate Corrosion (3.9)</option>
                            <option value="3.10">Brine Corrosion (3.10)</option>
                            <option value="3.11">Brittle Fracture (3.11)</option>
                            <option value="3.12">Carbonate Stress Corrosion Cracking (3.12)</option>
                            <option value="3.13">Carburization (3.13)</option>
                            <option value="3.14">Caustic Corrosion (3.14)</option>
                            <option value="3.15">Caustic Stress Corrosion Cracking (3.15)</option>
                            <option value="3.16">Cavitation (3.16)</option>
                            <option value="3.17">Chloride Stress Corrosion Cracking (3.17)</option>
                            <option value="3.18">CO₂ Corrosion (3.18)</option>
                            <option value="3.19">Concentration Cell Corrosion (3.19)</option>
                            <option value="3.20">Cooling Water Corrosion (3.20)</option>
                            <option value="3.21">Corrosion Fatigue (3.21)</option>
                            <option value="3.22">Corrosion Under Insulation (CUI) (3.22)</option>
                            <option value="3.23">Creep and Stress Rupture (3.23)</option>
                            <option value="3.24">Dealloying (3.24)</option>
                            <option value="3.25">Decarburization (3.25)</option>
                            <option value="3.26">Dissimilar Metal Weld Cracking (3.26)</option>
                            <option value="3.27">Erosion / Erosion-Corrosion (3.27)</option>
                            <option value="3.28">Ethanol Stress Corrosion Cracking (3.28)</option>
                            <option value="3.29">Flue Gas Dew Point Corrosion (3.29)</option>
                            <option value="3.30">Fuel Ash Corrosion (3.30)</option>
                            <option value="3.31">Galvanic Corrosion (3.31)</option>
                            <option value="3.32">Gaseous Oxygen-enhanced Ignition and Combustion (3.32)</option>
                            <option value="3.33">Graphitic Corrosion of Cast Irons (3.33)</option>
                            <option value="3.34">Graphitization (3.34)</option>
                            <option value="3.35">High-temperature H₂/H₂S Corrosion (3.35)</option>
                            <option value="3.36">High-temperature Hydrogen Attack (3.36)</option>
                            <option value="3.37">Hydrochloric Acid Corrosion (3.37)</option>
                            <option value="3.38">Hydrofluoric Acid Corrosion (3.38)</option>
                            <option value="3.39">Hydrofluoric Acid Stress Corrosion Cracking of Nickel Alloys (3.39)</option>
                            <option value="3.40">Hydrogen Embrittlement (3.40)</option>
                            <option value="3.41">Hydrogen Stress Cracking in Hydrofluoric Acid (3.41)</option>
                            <option value="3.42">Liquid Metal Embrittlement (3.42)</option>
                            <option value="3.43">Mechanical Fatigue (including Vibration-Induced Fatigue) (3.43)</option>
                            <option value="3.44">Metal Dusting (3.44)</option>
                            <option value="3.45">Microbiologically Influenced Corrosion (MIC) (3.45)</option>
                            <option value="3.46">Naphthenic Acid Corrosion (3.46)</option>
                            <option value="3.47">Nitriding (3.47)</option>
                            <option value="3.48">Oxidation (3.48)</option>
                            <option value="3.49">Oxygenated Process Water Corrosion (3.49)</option>
                            <option value="3.50">Phenol (Carbolic Acid) Corrosion (3.50)</option>
                            <option value="3.51">Phosphoric Acid Corrosion (3.51)</option>
                            <option value="3.52">Polythionic Acid Stress Corrosion Cracking (3.52)</option>
                            <option value="3.53">Refractory Degradation (3.53)</option>
                            <option value="3.54">Stress Relaxation Cracking (Reheat Cracking) (3.54)</option>
                            <option value="3.55">Short-term Overheating-Stress Rupture (3.55)</option>
                            <option value="3.56">Sigma Phase Embrittlement (3.56)</option>
                            <option value="3.57">Soil Corrosion (3.57)</option>
                            <option value="3.58">Sour Water Corrosion (Acidic) (3.58)</option>
                            <option value="3.59">Spheroidization (Softening) (3.59)</option>
                            <option value="3.60">Strain Aging (3.60)</option>
                            <option value="3.61">Sulfidation (3.61)</option>
                            <option value="3.62">Sulfuric Acid Corrosion (3.62)</option>
                            <option value="3.63">Temper Embrittlement (3.63)</option>
                            <option value="3.64">Thermal Fatigue (3.64)</option>
                            <option value="3.65">Thermal Shock (3.65)</option>
                            <option value="3.66">Titanium Hydriding (3.66)</option>
                            <option value="3.67">Wet H₂S Damage (Blistering / HIC / SOHIC / SSC) (3.67)</option>
                        </select>
                    </label>

                    <label>
                        Failure description
                        <textarea id="description" rows="6"
                            placeholder="Material, environment, operating conditions, service time, and what you observed (pitting, leaks, cracks, etc.)"></textarea>
                    </label>

                    <button type="submit">Analyze</button>
                </form>

                <!-- Loading / status -->
                <div id="agent-status" class="agent-status">
                    <div class="agent-spinner"></div>
                    <span id="agent-status-text">Analyzing...</span>
                </div>

                <!-- Results -->
                <div id="agent-results" class="agent-results">
                    <h2 class="agent-section-title">Mechanism assessment</h2>
                    <div id="agent-mechanisms" class="agent-mechanisms"></div>

                    <h2 class="agent-section-title">Recommendations</h2>
                    <div id="agent-recs" class="agent-recs"></div>
                </div>
            </div>
        </section>

        <div style="height:80px;"></div>

        <!-- If you still use script.js for image upload on other pages -->
        <script src="script.js"></script>

        <!-- Agent JS -->
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('agent-form');
            if (!form) return;

            const statusBox = document.getElementById('agent-status');
            const statusText = document.getElementById('agent-status-text');
            const resultsBox = document.getElementById('agent-results');
            const mechBox = document.getElementById('agent-mechanisms');
            const recsBox = document.getElementById('agent-recs');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const desc = document.getElementById('description').value.trim();
                const mechId = document.getElementById('mechanism').value;

                if (!desc) {
                    alert('Please enter a failure description.');
                    return;
                }

                // show loader
                statusBox.style.display = 'flex';
                statusText.textContent = 'Analyzing...';
                resultsBox.style.display = 'none';

                try {
                    const resp = await fetch('http://127.0.0.1:5000/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            description: desc,
                            mechanism_id: mechId
                        })
                    });

                    if (!resp.ok) {
                        let errMsg = 'Server error (' + resp.status + ')';
                        try {
                            const errData = await resp.json();
                            if (errData && errData.error) errMsg = errData.error;
                        } catch (_) {}
                        throw new Error(errMsg);
                    }

                    const data = await resp.json();

                    const mechs = data.mechanisms || [];
                    mechBox.textContent = mechs.map(m =>
                        `${m.name} — ${(m.confidence * 100).toFixed(0)}% confidence\n${m.reasoning}`
                    ).join('\n\n');

                    const rec = data.recommendations || {};
                    const listHtml = (items) => (items || []).map(i => `<li>${i}</li>`).join('');

                    recsBox.innerHTML = `
                        <h4>Immediate actions</h4>
                        <ul>${listHtml(rec.immediate)}</ul>

                        <h4>Medium-term actions</h4>
                        <ul>${listHtml(rec.medium_term)}</ul>

                        <h4>Long-term actions</h4>
                        <ul>${listHtml(rec.long_term)}</ul>

                        <h4>Monitoring</h4>
                        <ul>${listHtml(rec.monitoring)}</ul>

                        <h4>Information gaps</h4>
                        <ul>${listHtml(rec.gaps)}</ul>
                    `;

                    statusText.textContent = 'Analysis complete';
                    resultsBox.style.display = 'block';
                } catch (err) {
                    console.error(err);
                    statusText.textContent = 'Error: ' + err.message;
                }
            });
        });
        </script>
    </body>
</html>